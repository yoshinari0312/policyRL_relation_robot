# Copy this file to `app/config.local.yaml` and fill in your secrets.
# This template is safe to commit.
env:
  max_steps: 6
  include_robot: true
  max_history: 8
  reward_backend: "context_llm"
  personas:
    - "思いやりがあり空気を読む聞き上手。穏やかに場を整える。"
    - "朗らかで協力的。みんなの意見をまとめて励ますのが得意。"
    - "落ち着いた分析家。丁寧な言葉で現実的な解決策を提案する。"
    - "自己中心的で他人の話を遮りがち。批判的な口調になりやすい。"
    - "疑い深く皮肉屋。相手の発言を試すように突っ込む。"
    - "感情の起伏が激しく、すぐ苛立った口調になる。"
  debug: true

scorer:
  backend: "ollama"
  use_ema: true
  decay_factor: 1.5
  ema_alpha: 0.8

ollama:
  bases:
    - "http://ollama_a:11434"
    - "http://ollama_b:11435"
    - "http://ollama_c:11436"
  model: "gpt-oss:20b"
  model_rl: "gpt-oss:20b"
  scorer_base: "http://ollama_d:11434"
  reward_base: "http://ollama_reward:11434"
  gen_options:
    temperature: 0.75
    top_p: 0.9
    num_ctx: 2048

openai:
  api_key: "<YOUR_OPENAI_API_KEY>"  # e.g. set via .env or environment variable instead of committing
  model: "gpt-4.1"
  api_version: "2024-02-01"
  azure_endpoint: "https://your-azure-endpoint/"
  azure_api_key: "<YOUR_AZURE_API_KEY>"
  azure_api_version: "2024-12-01-preview"
  embedding_deployment: "text-embedding-3-small"
  embedding_api_version: "2024-12-01-preview"

ppo:
  model_name_or_path: "unsloth/Qwen3-14B-unsloth-bnb-4bit"
  revision: null
  lora_rank: 16
  lr: 3e-5
  batch_size: 4
  per_device_train_batch_size: 4
  per_device_eval_batch_size: 4
  ppo_epochs: 3
  grad_accum_steps: 1
  max_new_tokens: 64
  temperature: 0.70
  top_p: 0.90
  similarity_retry_threshold: 0.9
  similarity_retry_max_attempts: 3
  repetition_semantic_penalty: 0.2
  repetition_semantic_threshold: 0.9
  kl_coef: 0.01
  target_kl: 0.04
  kl_adjust_up: 2.0
  kl_adjust_down: 0.5
  cliprange: 0.2
  cliprange_value: 0.2
  total_updates: 60
  episode_len: 6
  missing_eos_penalty: 0.5
  non_japanese_penalty: -3
  repetition_penalty: -0.5
  repetition_lookback: 8
  output_dir: "../models/ppo_robot"
  max_memory_per_device_gib: 44
  cuda_visible_devices: "0,1,2,3"
  device_map_strategy: "balanced_low_0"
  ref_device: 3
  prompt_feed_debug: false
  local_rollout_forward_batch_size: 1
  gradient_checkpointing: true
